(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{35:function(e,t,a){e.exports=a(66)},40:function(e,t,a){},41:function(e,t,a){},66:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(31),l=a.n(r),i=(a(40),a(2)),o=a(3),c=a(5),m=a(4),d=a(6),u=(a(41),a(8)),h=a(15),p=a(1),g=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(m.a)(t).call(this))).state={expandNavbar:!1,hasToggle:!1},e.toggle=e.toggle.bind(Object(p.a)(e)),e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.setState({expandNavbar:window.innerWidth>768,hasToggle:window.innerWidth<=768})}},{key:"toggle",value:function(){this.setState((function(e){return console.log("toggle"),{expandNavbar:!e.expandNavbar}}))}},{key:"logOut",value:function(e){e.preventDefault(),this.toggle(),localStorage.removeItem("usertoken"),this.props.history.push("/")}},{key:"render",value:function(){var e=s.a.createElement("ul",{className:"navbar-nav"},s.a.createElement("li",{className:"nav-item"},s.a.createElement(u.b,{to:"/",className:"nav-link",onClick:this.toggle},"Home")),s.a.createElement("li",{className:"nav-item"},s.a.createElement(u.b,{to:"/login",className:"nav-link",onClick:this.toggle},"Login")),s.a.createElement("li",{className:"nav-item"},s.a.createElement(u.b,{to:"/register",className:"nav-link",onClick:this.toggle},"Register"))),t=s.a.createElement("ul",{className:"navbar-nav"},s.a.createElement("li",{className:"nav-item"},s.a.createElement(u.b,{to:"/",className:"nav-link",onClick:this.toggle},"Home")),s.a.createElement("li",{className:"nav-item"},s.a.createElement(u.b,{to:"/profile",className:"nav-link",onClick:this.toggle},"My Profile")),s.a.createElement("li",{className:"nav-item"},s.a.createElement(u.b,{to:"/channels",className:"nav-link",onClick:this.toggle},"Channels")),s.a.createElement("li",{className:"nav-item"},s.a.createElement(u.b,{to:"/",onClick:this.logOut.bind(this),className:"nav-link"},"Logout"))),a=s.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbars","aria-controls":"navbars","aria-expanded":"false","aria-label":"Toggle navigation",onClick:this.toggle},s.a.createElement("div",{className:"navbar-toggler-lines"},s.a.createElement("div",{className:"navbar-toggler-line"}),s.a.createElement("div",{className:"navbar-toggler-line"}),s.a.createElement("div",{className:"navbar-toggler-line"})));return s.a.createElement("nav",{className:"navbar-container"},this.state.hasToggle?a:null,s.a.createElement("div",{className:this.state.hasToggle?this.state.expandNavbar?"navbar show":"navbar collapse":"dummy",id:"navbars"},localStorage.usertoken?t:e))}}]),t}(n.Component),_=Object(h.e)(g),v=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"welcome_page"},s.a.createElement("h1",{className:"container_header"},"Welcome to Belay")))}}]),t}(n.Component),f=a(9),y=a(10),E=a.n(y),w=function(e){var t=e.match(/(https?:\/\/[^\s]+.(jpg|jpeg|png|gif))/g);return null==t?"":t},b=function(){return null!==localStorage.usertoken&&void 0!==localStorage.usertoken},k=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(m.a)(t).call(this))).state={email:"",password:""},e.onChange=e.onChange.bind(Object(p.a)(e)),e.onSubmit=e.onSubmit.bind(Object(p.a)(e)),e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"onChange",value:function(e){var t=this,a=e.target.name;this.setState(Object(f.a)({},a,e.target.value),(function(){"email"===a&&t.checkEmail()}))}},{key:"checkEmail",value:function(){return 0===this.state.email.length?(document.getElementById("email_validate_warning").innerText="Required",!1):/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(this.state.email)?(document.getElementById("email_validate_warning").innerText="",!0):(document.getElementById("email_validate_warning").innerText="Invalid email address",!1)}},{key:"onSubmit",value:function(e){var t=this;(e.preventDefault(),!1!==this.checkEmail())&&function(e){return E.a.post("/api/login",{email:e.email,password:e.password}).then((function(e){return 200===e.status&&(console.log("Logged in successfully"),localStorage.setItem("usertoken",e.data.token)),e}),(function(e){return console.log("POST /api/login failed. Details: ",e.response.data.error),e.response}))}({email:this.state.email,password:this.state.password}).then((function(e){if(200===e.status){var a=localStorage.usertoken;console.log("Got a temporary token: ",a),t.props.history.push("/profile")}else document.getElementById("login_failure_reason").innerText=e.data.error}))}},{key:"componentWillUnmount",value:function(){this.setState({email:"",password:""})}},{key:"render",value:function(){return s.a.createElement("div",{className:"content_container container"},s.a.createElement("form",{noValidate:!0,className:"login_form",onSubmit:this.onSubmit},s.a.createElement("h1",{className:"login_form_header"},"Please sign in"),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"email"},"Email address"),s.a.createElement("input",{type:"email",className:"form-control",name:"email",placeholder:"Enter email",value:this.state.email,onChange:this.onChange}),s.a.createElement("span",{id:"email_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"password"},"Password"),s.a.createElement("input",{type:"password",className:"form-control",name:"password",placeholder:"Password",value:this.state.password,onChange:this.onChange})),s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{type:"submit"},"Sign in")),s.a.createElement("div",{className:"form-group"},s.a.createElement("span",{id:"login_failure_reason"})),s.a.createElement("div",{className:"form-group",id:"links-form-group"},s.a.createElement(u.b,{id:"forget_password_link",to:"/forget_password"},"Forgot Password?"),s.a.createElement("br",null),s.a.createElement(u.b,{id:"register_link",to:"/register"},"Sign up"))))}}]),t}(n.Component),N=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(m.a)(t).call(this))).state={name:"",email:"",password:"",retype_password:""},e.onChange=e.onChange.bind(Object(p.a)(e)),e.onSubmit=e.onSubmit.bind(Object(p.a)(e)),e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"onChange",value:function(e){var t=this,a=e.target.name;this.setState(Object(f.a)({},a,e.target.value),(function(){t.checkInputs(a)}))}},{key:"checkInputs",value:function(e){switch(e){case"name":this.checkName();break;case"email":this.checkEmail();break;case"password":this.checkPassword();break;case"retype_password":this.checkRetypePassword()}}},{key:"checkName",value:function(){return this.state.name.length<2?(document.getElementById("name_validate_warning").innerText="Name length should be at least 2",!1):(document.getElementById("name_validate_warning").innerText="",!0)}},{key:"checkEmail",value:function(){return 0===this.state.email.length?(document.getElementById("email_validate_warning").innerText="Required",!1):/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(this.state.email)?(document.getElementById("email_validate_warning").innerText="",!0):(document.getElementById("email_validate_warning").innerText="Invalid email address",!1)}},{key:"checkPassword",value:function(){return 0===this.state.password.length?(document.getElementById("password_validate_warning").innerText="Required",!1):/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,100}$/.test(this.state.password)?(document.getElementById("password_validate_warning").innerText="",!0):(document.getElementById("password_validate_warning").innerText="Must be 8 characters or more, needs at least one numeric digit, one uppercase and one lowercase letter",!1)}},{key:"checkRetypePassword",value:function(){return this.state.password!==this.state.retype_password?(document.getElementById("retype_password_validate_warning").innerText="The passwords you entered do not match.",!1):(document.getElementById("retype_password_validate_warning").innerText="",!0)}},{key:"onSubmit",value:function(e){var t=this;(e.preventDefault(),!1!==(this.checkName()&&this.checkEmail()&&this.checkPassword()&&this.checkRetypePassword()))&&function(e){return E.a.post("/api/register",{name:e.name,email:e.email,password:e.password}).then((function(e){return 200===e.status&&(console.log("Registered successfully"),localStorage.setItem("usertoken",e.data.token)),e}),(function(e){return console.log("POST /api/update_password failed. Details: ",e.response.data.error),e.response}))}({name:this.state.name,email:this.state.email,password:this.state.password}).then((function(e){if(200===e.status){var a=localStorage.usertoken;console.log("Got a temporary token: ",a),t.props.history.push("/profile")}else 400===e.status&&(document.getElementById("register_submit_warning").innerText=e.data.error)}))}},{key:"componentWillUnmount",value:function(){this.setState({name:"",email:"",password:"",retype_password:""})}},{key:"render",value:function(){return s.a.createElement("div",{className:"content_container container"},s.a.createElement("form",{className:"login_form",onSubmit:this.onSubmit},s.a.createElement("h1",{className:"login_form_header"},"Please register"),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"name"},"Name"),s.a.createElement("input",{type:"text",className:"form-control",name:"name",placeholder:"Enter your name",value:this.state.name,onChange:this.onChange,onBlur:this.onChange}),s.a.createElement("span",{id:"name_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"email"},"Email address"),s.a.createElement("input",{type:"email",className:"form-control",name:"email",placeholder:"Enter email",value:this.state.email,onChange:this.onChange}),s.a.createElement("span",{id:"email_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"password"},"Password"),s.a.createElement("input",{type:"password",className:"form-control",name:"password",placeholder:"Password",value:this.state.password,onChange:this.onChange}),s.a.createElement("span",{id:"password_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"password"},"Confirm password"),s.a.createElement("input",{type:"password",className:"form-control",name:"retype_password",placeholder:"Retype password",value:this.state.retype_password,onChange:this.onChange}),s.a.createElement("span",{id:"retype_password_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{type:"submit"},"Register!"),s.a.createElement("span",{id:"register_submit_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement(u.b,{to:"/login"},"Already have an account?"))))}}]),t}(n.Component),C=a(34),S=a.n(C),I=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(m.a)(t).call(this))).state={oldName:"",oldEmail:"",newName:"",newEmail:"",edit_name_form_expanded:!1,edit_email_form_expanded:!1},e.onChange=e.onChange.bind(Object(p.a)(e)),e.expandOrShrink=e.expandOrShrink.bind(Object(p.a)(e)),e.onSubmit=e.onSubmit.bind(Object(p.a)(e)),e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"checkHasUsertokenRepeatly",value:function(){b()||(clearInterval(this.interval),alert("Your usertoken has expired!"),this.props.history.push("/"))}},{key:"componentDidMount",value:function(){var e=this;this.setStateWithUsertoken(),document.getElementById("edit_name_form").style.display="none",document.getElementById("edit_email_form").style.display="none",this.check=setInterval((function(){return e.checkHasUsertokenRepeatly()}),500)}},{key:"componentWillUnmount",value:function(){clearInterval(this.check),this.setState({oldName:"",oldEmail:"",newName:"",newEmail:"",edit_name_form_expanded:!1,edit_email_form_expanded:!1})}},{key:"setStateWithUsertoken",value:function(){var e=S()(localStorage.usertoken);this.setState({oldName:e.name,oldEmail:e.email})}},{key:"onChange",value:function(e){var t=this,a=e.target.name;this.setState(Object(f.a)({},a,e.target.value),(function(){"newName"===a?t.checkName():"newEmail"===a&&t.checkEmail()}))}},{key:"checkName",value:function(){if(this.state.newName===this.state.oldName)document.getElementById("name_validate_warning").innerText="New name cannot be the same as the old one";else{if(!(this.state.newName.length<2))return document.getElementById("name_validate_warning").innerText="",!0;document.getElementById("name_validate_warning").innerText="Username must be longer than 1"}return!1}},{key:"checkEmail",value:function(){if(0===this.state.newEmail.length)document.getElementById("email_validate_warning").innerText="Required";else if(this.state.newEmail===this.state.oldEmail)document.getElementById("email_validate_warning").innerText="New email cannot be the same as the old one";else{if(/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(this.state.newEmail))return document.getElementById("email_validate_warning").innerText="",!0;document.getElementById("email_validate_warning").innerText="Invalid email address"}return!1}},{key:"onSubmit",value:function(e){var t,a=this;switch(e.preventDefault(),e.target.id){case"edit_name_form":if(!this.checkName())return;var n={name:this.state.newName,usertoken:localStorage.usertoken};(t=n,E.a.post("/api/user",{name:t.name},{headers:{Authorization:"Bearer "+t.usertoken}}).then((function(e){return 200===e.status&&(console.log("Updated username successfully"),localStorage.setItem("usertoken",e.data.token)),e}),(function(e){return console.log("POST /api/user failed. Details: ",e.response.data.error),401===e.response.status&&localStorage.removeItem("usertoken"),e.response}))).then((function(e){200===e.status?(a.setStateWithUsertoken(),a.setState({edit_name_form_expanded:!1})):document.getElementById("update_name_warning").innerText=e.data.error}));break;case"edit_email_form":if(!this.checkEmail())return;(function(e){return E.a.post("/api/user",{email:e.email},{headers:{Authorization:"Bearer "+e.usertoken}}).then((function(e){return 200===e.status&&(console.log("Updated email address successfully"),localStorage.setItem("usertoken",e.data.token)),e}),(function(e){return console.log("POST /api/user failed. Details: ",e.response.data.error),401===e.response.status&&localStorage.removeItem("usertoken"),e.response}))})({email:this.state.newEmail,usertoken:localStorage.usertoken}).then((function(e){200===e.status?(a.setStateWithUsertoken(),a.setState({edit_email_form_expanded:!1})):document.getElementById("update_email_warning").innerText=e.data.error}))}}},{key:"expandOrShrink",value:function(e){var t=e.target.id;switch(t.substring(0,t.length-7)){case"edit_name_form":var a=this.state.edit_name_form_expanded;document.getElementById("edit_name_form").style.display=a?"none":"block",document.getElementById("edit_name_form_button").innerHTML=a?"+":"-",this.setState({edit_name_form_expanded:!a});break;case"edit_email_form":var n=this.state.edit_email_form_expanded;document.getElementById("edit_email_form").style.display=n?"none":"block",document.getElementById("edit_email_form_button").innerHTML=n?"+":"-",this.setState({edit_email_form_expanded:!n})}}},{key:"render",value:function(){return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"container_header"},s.a.createElement("h1",{className:"text-center"},"Profile")),s.a.createElement("div",{className:"container_body_wrapper"},s.a.createElement("div",{className:"container_body"},s.a.createElement("hr",null),s.a.createElement("div",{className:"profile_row"},s.a.createElement("div",{className:"profile_name"},"Name"),s.a.createElement("div",{className:"profile_name_value"},this.state.oldName),s.a.createElement("div",{className:"profile_button",id:"edit_name_form_button",onClick:this.expandOrShrink},"+")),s.a.createElement("form",{className:"edit_profile_form",id:"edit_name_form",onSubmit:this.onSubmit},s.a.createElement("div",{className:"form-group"},s.a.createElement("input",{type:"text",className:"form-control",name:"newName",value:this.state.newName,placeholder:"New name",onChange:this.onChange}),s.a.createElement("span",{id:"name_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{type:"submit"},"Update Name"),s.a.createElement("span",{id:"update_name_warning"}))),s.a.createElement("hr",null),s.a.createElement("div",{className:"profile_row"},s.a.createElement("div",{className:"profile_name"},"Email"),s.a.createElement("div",{className:"profile_name_value"},this.state.oldEmail),s.a.createElement("div",{className:"profile_button",id:"edit_email_form_button",onClick:this.expandOrShrink},"+")),s.a.createElement("form",{className:"edit_profile_form",id:"edit_email_form",onSubmit:this.onSubmit},s.a.createElement("div",{className:"form-group"},s.a.createElement("input",{type:"email",className:"form-control",name:"newEmail",value:this.state.newEmail,placeholder:"New email address",onChange:this.onChange}),s.a.createElement("span",{id:"email_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{type:"submit"},"Update Email"),s.a.createElement("span",{id:"update_email_warning"}))),s.a.createElement("hr",null))))}}]),t}(n.Component),O=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"onClick",value:function(e){this.props.history.push("/channel/"+e.target.parentNode.id)}},{key:"render",value:function(){var e=s.a.createElement("button",{className:"delete_channel_item_button",onClick:this.props.delete},"Delete");return s.a.createElement("div",{className:"channel",id:this.props.channel_id,key:this.props.key},s.a.createElement("span",{className:"channel_name",onClick:this.onClick.bind(this)},this.props.name),"True"===this.props.creator_is_me?e:null)}}]),t}(n.Component),j=Object(h.e)(O),B=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(m.a)(t).call(this))).delete=function(t,a){var n,s={channel_id:t,usertoken:localStorage.usertoken};(n=s,E.a.post("/api/delete",{channel_id:n.channel_id},{headers:{Authorization:"Bearer "+n.usertoken}}).then((function(e){if(200===e.status)return console.log("Deleted channel successfully"),e}),(function(e){return console.log("POST /api/create failed. Details: ",e.response.data.error),e.response}))).then((function(t){if(t.status){var n=Object.assign([],e.state.channelItems);n.splice(a,1),e.setState({channelItems:n})}}))},e.channelItemID=0,e.state={newChannelName:"",channelItems:[]},e.onSubmit=e.onSubmit.bind(Object(p.a)(e)),e.onChange=e.onChange.bind(Object(p.a)(e)),e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.loadChannels(),this.check=setInterval((function(){return e.checkHasUsertokenRepeatly()}),500)}},{key:"componentWillUnmount",value:function(){clearInterval(this.check)}},{key:"checkHasUsertokenRepeatly",value:function(){b()||(clearInterval(this.interval),alert("Your usertoken has expired!"),this.props.history.push("/"))}},{key:"loadChannels",value:function(){var e=this;if(null===localStorage.usertoken||void 0===localStorage.usertoken)return alert("Your token has expired"),void this.props.history.push("/");var t={usertoken:localStorage.usertoken},a=[];(function(e){return E.a.get("/api/channels",{headers:{Authorization:"Bearer "+e.usertoken}}).then((function(e){if(200===e.status)return e.data.channels}),(function(e){console.log("GET /api/channels failed. Details: ",e.response.data.error),401===e.response.status&&localStorage.removeItem("usertoken")}))})(t).then((function(t){null!==t&&void 0!==t&&0!==t.length&&(t.forEach((function(t){e.channelItemID=e.channelItemID+1,t.id=e.channelItemID,t.key=e.channelItemID,a.push(t)})),e.setState({channelItems:a}))}))}},{key:"onChange",value:function(e){var t=this;this.setState(Object(f.a)({},e.target.name,e.target.value),(function(){t.checkName()}))}},{key:"checkName",value:function(){return console.log(/^[a-zA-Z0-9-_]+$/.test(this.state.newChannelName)),0===this.state.newChannelName.length?(document.getElementById("name_validate_warning").innerText="Required",!1):/^[a-zA-Z0-9-_]+$/.test(this.state.newChannelName)?(document.getElementById("name_validate_warning").innerText="",!0):(document.getElementById("name_validate_warning").innerText="The name should only consist of numbers, letters, and underscores (and no spaces)",!1)}},{key:"onSubmit",value:function(e){var t=this;if(e.preventDefault(),this.checkName()){var a,n={usertoken:localStorage.usertoken,name:this.state.newChannelName};(a=n,E.a.post("/api/create",{name:a.name},{headers:{Authorization:"Bearer "+a.usertoken}}).then((function(e){return 200===e.status&&console.log("Created channel successfully"),e}),(function(e){return console.log("POST /api/create failed. Details: ",e.response.data.error),401===e.response.status&&localStorage.removeItem("usertoken"),e.response}))).then((function(e){if(200===e.status){var a="/channel/"+e.data.id;alert("Create Successfully"),t.props.history.push(a)}else document.getElementById("create_channel_warning").innerHTML=e.data.error}))}}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"container_header"},s.a.createElement("h1",{className:"text-center"},"Channels"),s.a.createElement("div",{id:"create_channel_div",onMouseEnter:function(){return document.getElementById("create_channel_span").style.display="block"},onMouseLeave:function(){return document.getElementById("create_channel_span").style.display="none"},onClick:function(){return document.querySelector(".pop_up_wrapper").style.display="block"}},"+"),s.a.createElement("span",{id:"create_channel_span"},"Click to create channel")),s.a.createElement("div",{className:"container_body_wrapper"},s.a.createElement("div",{className:"container_body"},s.a.createElement("div",{className:"pop_up_wrapper"},s.a.createElement("form",{noValidate:!0,className:"login_form",onSubmit:this.onSubmit},s.a.createElement("div",{className:"close",onClick:function(){return document.querySelector(".pop_up_wrapper").style.display="none"}},"x"),s.a.createElement("h1",{className:"login_form_header"},"Create a new channel"),s.a.createElement("div",{className:"form-group"},s.a.createElement("input",{type:"text",className:"form-control",name:"newChannelName",placeholder:"New channel name",value:this.state.password,onChange:this.onChange}),s.a.createElement("span",{id:"name_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{type:"submit"},"Create")),s.a.createElement("div",{className:"form-group"},s.a.createElement("span",{id:"create_channel_warning"})))),s.a.createElement("div",{className:"channels"},s.a.createElement("hr",null),this.state.channelItems.map((function(t,a){return s.a.createElement("div",{key:t.key},s.a.createElement(j,{channel_id:t.channel_id,name:t.name,creator_is_me:t.creator_is_me,delete:e.delete.bind(e,t.channel_id,a)}),s.a.createElement("hr",null))}))))))}}]),t}(n.Component),x=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(m.a)(t).call(this))).state={id:"",last_polled_reply_id:0,replies:[],show_replies:!1},e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"dismiss",value:function(){this.props.unmountMe()}},{key:"checkHasUsertokenRepeatly",value:function(){b()||(clearInterval(this.interval),alert("Your usertoken has expired!"),this.props.history.push("/"))}},{key:"componentDidMount",value:function(){var e=this;this.setState({id:"message_id_"+this.props.id}),this.check=setInterval((function(){return e.checkHasUsertokenRepeatly()}),500)}},{key:"componentWillUnmount",value:function(){clearInterval(this.check),null!==this.interval&&void 0!==this.interval&&clearInterval(this.interval)}},{key:"onClick",value:function(e){this.displayThreads(e.target.parentNode)}},{key:"displayThreads",value:function(e){var t=this;this.setState({show_replies:!0});var a=e.id.split("_"),n=a[a.length-1];console.log(n),window.innerWidth<=768?(document.getElementById("new_message_notification").style.display="none",document.getElementsByClassName("messages_container")[0].style.width="0%",document.getElementsByClassName("replies_container")[0].style.width="100%",document.getElementsByClassName("replies_container")[0].style.display="block"):(document.getElementsByClassName("messages_container")[0].style.width="60%",document.getElementsByClassName("replies_container")[0].style.width="40%",document.getElementsByClassName("replies_container")[0].style.display="block");["reply","replies_counts_separator"].forEach((function(e){for(var t=document.getElementsByClassName(e);t.length>0;)t[0].parentNode.removeChild(t[0])}));var s=e.cloneNode(!0),r=s.lastChild;s.removeChild(r),s.setAttribute("class","reply"),s.appendChild(document.createElement("hr")),document.getElementById("origin_message").appendChild(s),this.state.replies.forEach((function(e){var t=document.createElement("div");t.id="reply_id_"+e.id,t.className="reply";var a=document.createElement("span");a.className="sender_name",a.innerHTML=e.sender_name,t.append(a);var n=document.createElement("span");n.className="created_time",n.innerHTML=e.created_time,t.append(n);var s=document.createElement("div");s.className="content",s.textContent=e.content,t.append(s);var r=w(e.content);if(r.length>0){var l=document.createElement("div");l.className="message_image_wrapper";for(var i=0;i<r.length;i++){var o=document.createElement("img");o.src=r[i],o.alt=r[i],l.append(o)}t.append(l)}document.getElementById("other_replies").appendChild(t)})),null!==this.interval&&void 0!==this.interval&&clearInterval(this.interval),this.interval=setInterval((function(){return t.getRepliesRepeatly(n)}),1e3)}},{key:"getRepliesRepeatly",value:function(e){var t,a=this,n={url:"/api/replies/"+e+"?last_polled_reply_id="+this.state.last_polled_reply_id,usertoken:localStorage.usertoken},s=Object.assign([],this.state.replies);(t=n,E.a.get(t.url,{headers:{Authorization:"Bearer "+t.usertoken}}).then((function(e){if(200===e.status)return console.log("Polled replies successfully"),e.data.replies}),(function(e){console.log("GET ",t.url," failed. Details: ",e.response.data.error)}))).then((function(e){null!==e&&void 0!==e&&0!==e.length&&(e.forEach((function(e){s.push(e);var t=document.createElement("div");t.id="reply_id_"+e.id,t.className="reply";var a=document.createElement("span");a.className="sender_name",a.innerHTML=e.sender_name,t.append(a);var n=document.createElement("span");n.className="created_time",n.innerHTML=e.created_time,t.append(n);var r=document.createElement("div");r.className="content",r.textContent=e.content,t.append(r);var l=w(e.content);if(l.length>0){var i=document.createElement("div");i.className="message_image_wrapper";for(var o=0;o<l.length;o++){var c=document.createElement("img");c.src=l[o],c.alt=l[o],i.append(c)}t.append(i)}document.getElementById("other_replies").appendChild(t)})),a.setState({last_polled_reply_id:e[e.length-1].id,replies:s}))}))}},{key:"render",value:function(){var e=w(this.props.content);if(e&&e.length>0)var t=e.map((function(e,t){return s.a.createElement("div",{className:"message_image_wrapper",key:t},s.a.createElement("img",{src:"".concat(e),alt:"".concat(e)}))}));return s.a.createElement("div",{className:"message",id:this.state.id,key:this.state.id},s.a.createElement("span",{className:"sender_name"},this.props.sender_name),s.a.createElement("span",{className:"created_time"},this.props.created_time),s.a.createElement("div",{className:"content"},this.props.content),t||null,s.a.createElement("div",{className:"reply_counts",onClick:this.onClick.bind(this)},this.props.cnt_replies>0?this.props.cnt_replies+" replies":"Reply"))}}]),t}(n.Component),T=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"notification",onClick:this.props.scrollToUnread},s.a.createElement("span",{className:"unread_messages"},this.props.num," unread messages"))}}]),t}(n.Component),R=Object(h.e)(T),P=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(m.a)(t).call(this))).state={url:"",channelID:0,channelName:"",isJustOpened:!0,last_read_message_id:0,last_polled_message_id:0,unread_messages_num:0,new_message:"",new_reply:"",messages:[]},e.map=new Map([["new_message_form","new_message"],["new_reply_form","new_reply"]]),e.onChange=e.onChange.bind(Object(p.a)(e)),e.onSubmit=e.onSubmit.bind(Object(p.a)(e)),e.checkVisible=e.checkVisible.bind(Object(p.a)(e)),e.handleChildUnmount=e.handleChildUnmount.bind(Object(p.a)(e)),e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"checkHasUsertokenRepeatly",value:function(){b()||(clearInterval(this.interval),alert("Your usertoken has expired!"),this.props.history.push("/"))}},{key:"componentDidMount",value:function(){var e=this;document.getElementsByClassName("replies_container")[0].style.display="none";var t=this.props.location.pathname.split("/"),a=t[t.length-1];this.setState({url:this.props.location,channelID:a});var n,s={channel_id:a,usertoken:localStorage.usertoken};(n=s,E.a.post("/api/channelName",{channel_id:n.channel_id},{headers:{Authorization:"Bearer "+n.usertoken}}).then((function(e){if(200===e.status)return console.log("Got channel name successfully"),e.data.name}),(function(e){console.log("POST /api/channelName failed. Details: ",e.response.data.error),401===e.response.status&&localStorage.removeItem("usertoken")}))).then((function(t){null!==t&&void 0!==t&&(e.setState({channelName:t}),document.getElementById("channel_name").innerHTML="#"+t)})),this.check=setInterval((function(){return e.checkHasUsertokenRepeatly()}),500),this.interval=setInterval((function(){return e.getMesssagesRepeatly()}),500)}},{key:"componentWillUnmount",value:function(){this.setState({messages:[]}),clearInterval(this.interval),clearInterval(this.check)}},{key:"handleChildUnmount",value:function(){this.setState({messages:[]})}},{key:"getMesssagesRepeatly",value:function(){var e,t=this,a={url:"/api/messages/"+this.state.channelID+"?last_read_message_id="+this.state.last_read_message_id,usertoken:localStorage.usertoken},n=Object.assign([],this.state.messages),s=n.length,r=this.state.unread_messages_num,l=this.state.last_read_message_id,i=this.state.last_polled_message_id;(e=a,E.a.get(e.url,{headers:{Authorization:"Bearer "+e.usertoken}}).then((function(e){if(200===e.status)return console.log("Polled messages successfully"),e.data}),(function(t){console.log("GET ",e.url," failed. Details: ",t.response.data.error),401===t.response.status&&localStorage.removeItem("usertoken")}))).then((function(e){if(null!==e&&void 0!==e){var a=e.messages,o=e.server_side_last_read_message_id,c=Math.max(l,o);if(a.forEach((function(e,t){console.log("max_last_read_message_id:",c),console.log("message.id:",e.id),e.id>c&&e.id>i&&(r+=1),t>=s?n.push(e):n[t].cnt_replies=e.cnt_replies})),t.setState({messages:n,unread_messages_num:r,last_read_message_id:c}),null!==a&&a.length>0&&t.setState({last_polled_message_id:a[a.length-1].id}),t.state.isJustOpened){var m=c,d=document.getElementById("messages");if(0===m)d.scrollTop=0;else{var u=document.getElementById("message_id_"+m);d.scrollTop=u.offsetTop+u.offsetHeight-d.offsetHeight}t.setState({isJustOpened:!1})}}}))}},{key:"scrollToUnread",value:function(){var e=this.state.last_read_message_id,t=document.getElementById("messages");if(0===e)t.scrollTop=0;else{var a=document.getElementById("message_id_"+e);t.scrollTop=a.offsetTop+a.offsetHeight}this.checkVisible()}},{key:"checkVisible",value:function(){for(var e=document.getElementById("messages"),t=e.childNodes,a=this.state.last_read_message_id,n=this.state.unread_messages_num,s=0;s<t.length;s++){var r=t[s],l=r.id.split("_"),i=parseInt(l[l.length-1]);if(!(i<=a)){var o=r.getBoundingClientRect().top>=e.getBoundingClientRect().top&&r.getBoundingClientRect().top<=e.getBoundingClientRect().bottom,c=r.getBoundingClientRect().bottom>=e.getBoundingClientRect().top&&r.getBoundingClientRect().top<=e.getBoundingClientRect().bottom;(o||c)&&(n-=1,a=i)}}this.setState({last_read_message_id:a}),this.setState({unread_messages_num:n})}},{key:"render",value:function(){var e=this;return console.log("unread_messages_num:",this.state.unread_messages_num),s.a.createElement("div",{className:"container",id:"channel_page_container"},s.a.createElement("div",{className:"container_header"},s.a.createElement("h1",{className:"text-center",id:"channel_name"},"Channel")),s.a.createElement("div",{className:"container_body_wrapper"},s.a.createElement("div",{className:"messages_container"},s.a.createElement("div",{id:"new_message_notification"},this.state.unread_messages_num>0?s.a.createElement(R,{num:this.state.unread_messages_num,scrollToUnread:this.scrollToUnread.bind(this)}):null),s.a.createElement("div",{id:"messages",onScroll:this.checkVisible},this.state.messages.length>0?this.state.messages.map((function(t,a){return s.a.createElement(x,{key:t.id,id:t.id,sender_name:t.sender_name,created_time:t.created_time,content:t.content,cnt_replies:t.cnt_replies,unmountMe:e.handleChildUnmount})})):null),s.a.createElement("div",{id:"message_input"},s.a.createElement("form",{name:"new_message_form",onSubmit:this.onSubmit},s.a.createElement("textarea",{name:"new_message",id:"new_message_textarea",onChange:this.onChange}),s.a.createElement("button",{type:"submit"},"Submit")))),s.a.createElement("div",{className:"replies_container"},s.a.createElement("span",{id:"close",onClick:function(){document.getElementsByClassName("replies_container")[0].style.display="none",document.getElementsByClassName("messages_container")[0].style.width="100%",document.getElementById("new_message_notification").style.display="block"}},"x"),s.a.createElement("div",{className:"container_header",id:"header"},"Thread"),s.a.createElement("div",{className:"replies"},s.a.createElement("div",{id:"origin_message"}),s.a.createElement("div",{id:"other_replies"})),s.a.createElement("div",{id:"reply_input"},s.a.createElement("form",{name:"new_reply_form",onSubmit:this.onSubmit},s.a.createElement("textarea",{name:"new_reply",id:"new_reply_textarea",onChange:this.onChange}),s.a.createElement("button",{type:"submit"},"Submit"))))))}},{key:"onChange",value:function(e){this.setState(Object(f.a)({},e.target.name,e.target.value))}},{key:"onSubmit",value:function(e){e.preventDefault();var t="new_reply"===this.map.get(e.target.name);if((!t||0!==this.state.new_reply.length)&&(t||0!==this.state.new_message.length)){if(t){var a=document.getElementById("origin_message").childNodes[0].id.split("_"),n=parseInt(a[a.length-1]);console.log(n)}!function(e){E.a.post(e.url,{content:e.content,is_reply:e.is_reply,parent_message_id:e.parent_message_id},{headers:{Authorization:"Bearer "+e.usertoken}}).then((function(e){200===e.status&&console.log("Posted successfully")}),(function(t){console.log("POST ",e.url," failed. Details: ",t.response.data.error),401===t.response.status&&localStorage.removeItem("usertoken")}))}({url:"/api/post/"+this.state.channelID,usertoken:localStorage.usertoken,content:t?this.state.new_reply:this.state.new_message,is_reply:t,parent_message_id:t?n:-1}),t?(document.getElementById("new_reply_textarea").value="",this.setState({new_reply:""})):(document.getElementById("new_message_textarea").value="",this.setState({new_message:""}))}}}]),t}(n.Component),D=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(m.a)(t).call(this))).state={email:""},e.onChange=e.onChange.bind(Object(p.a)(e)),e.onSubmit=e.onSubmit.bind(Object(p.a)(e)),e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"onChange",value:function(e){var t=this,a=e.target.name;this.setState(Object(f.a)({},a,e.target.value),(function(){t.checkEmail()}))}},{key:"checkEmail",value:function(){return 0===this.state.email.length?(document.getElementById("email_validate_warning").innerText="Required",!1):/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(this.state.email)?(document.getElementById("email_validate_warning").innerText="",!0):(document.getElementById("email_validate_warning").innerText="Invalid email address",!1)}},{key:"onSubmit",value:function(e){if(e.preventDefault(),this.checkEmail()){var t,a={email:this.state.email};(t=a,E.a.post("/api/forget_password",{email:t.email}).then((function(e){return 200===e.status&&console.log("Sent reset password request successfully"),e}),(function(e){return console.log("POST /api/forget_password failed. Details: ",e.response.data.error),e.response}))).then((function(e){200===e.status?document.getElementById("login_failure_reason").innerText="Sent reset password request successfully":404===e.status&&(document.getElementById("login_failure_reason").innerText=e.data.error)}))}}},{key:"componentWillUnmount",value:function(){this.setState({email:""})}},{key:"render",value:function(){return s.a.createElement("div",{className:"content_container container"},s.a.createElement("div",{className:"login_form"},s.a.createElement("h1",{className:"login_form_header"},"Password Reset"),s.a.createElement("p",{className:"instruction"},"Enter your e-mail address below, and we'll send you an email allowing you to reset your password."),s.a.createElement("form",{id:"enter_email_form",onSubmit:this.onSubmit},s.a.createElement("div",{className:"form-group"},s.a.createElement("input",{type:"email",className:"form-control",name:"email",value:this.state.email,placeholder:"Your email address",onChange:this.onChange}),s.a.createElement("span",{id:"email_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{type:"submit"},"Reset my password")),s.a.createElement("div",{className:"form-group"},s.a.createElement("span",{id:"login_failure_reason"})))))}}]),t}(n.Component),U=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(m.a)(t).call(this))).state={password:"",retype_password:""},e.onChange=e.onChange.bind(Object(p.a)(e)),e.onSubmit=e.onSubmit.bind(Object(p.a)(e)),e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"onChange",value:function(e){var t=this,a=e.target.name;this.setState(Object(f.a)({},a,e.target.value),(function(){t.checkInputs(a)}))}},{key:"checkInputs",value:function(e){switch(e){case"password":this.checkPassword();break;case"retype_password":console.log("enter retype_password"),this.checkRetypePassword()}}},{key:"checkPassword",value:function(){return 0===this.state.password.length?(document.getElementById("password_validate_warning").innerText="Required",!1):/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,100}$/.test(this.state.password)?(document.getElementById("password_validate_warning").innerText="",!0):(document.getElementById("password_validate_warning").innerText="Must be 8 characters or more, needs at least one numeric digit, one uppercase and one lowercase letter",!1)}},{key:"checkRetypePassword",value:function(){return this.state.password!==this.state.retype_password?(document.getElementById("retype_password_validate_warning").innerText="The passwords you entered do not match.",!1):(document.getElementById("retype_password_validate_warning").innerText="",!0)}},{key:"onSubmit",value:function(e){var t=this;if(e.preventDefault(),this.checkPassword()&&this.checkRetypePassword()){var a=new URLSearchParams(window.location.search);if(a.has("token")){var n,s={token:a.get("token"),password:this.state.password};console.log(s),(n=s,E.a.post("/api/update_password",{token:n.token,password:n.password},{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(e){return 200===e.status&&console.log("Reset password successfully"),e}),(function(e){return console.log("POST /api/update_password failed. Details: ",e.response.data.error),e.response}))).then((function(e){200===e.status?(alert("Updated your password successfully. Will redirect to login page. Please login with your new password"),t.props.history.push("/login")):document.getElementById("update_password_warning").innerText=e.data.error}))}}}},{key:"componentWillUnmount",value:function(){this.setState({password:"",retype_password:""})}},{key:"render",value:function(){return s.a.createElement("div",{className:"login_form"},s.a.createElement("h1",{className:"login_form_header"},"Password Reset"),s.a.createElement("form",{id:"enter_email_form",onSubmit:this.onSubmit},s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"password"},"Password"),s.a.createElement("input",{type:"password",className:"form-control",name:"password",placeholder:"Password",value:this.state.password,onChange:this.onChange}),s.a.createElement("span",{id:"password_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"password"},"Confirm password"),s.a.createElement("input",{type:"password",className:"form-control",name:"retype_password",placeholder:"Retype password",value:this.state.retype_password,onChange:this.onChange}),s.a.createElement("span",{id:"retype_password_validate_warning"})),s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{type:"submit"},"Register!"),s.a.createElement("span",{id:"update_password_warning"}))))}}]),t}(n.Component),M=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(u.a,null,s.a.createElement("div",{className:"App"},s.a.createElement(_,null),s.a.createElement("div",{className:"content_container"},s.a.createElement(h.a,{exact:!0,path:"/",component:v}),s.a.createElement(h.a,{exact:!0,path:"/profile",component:I}),s.a.createElement(h.a,{exact:!0,path:"/register",component:N}),s.a.createElement(h.a,{exact:!0,path:"/login",component:k}),s.a.createElement(h.a,{exact:!0,path:"/channels",component:B}),s.a.createElement(h.a,{exact:!0,path:"/channel/:id",component:P}),s.a.createElement(h.a,{exact:!0,path:"/forget_password",component:D}),s.a.createElement(h.a,{exact:!0,path:"/reset_password",component:U}))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(s.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[35,1,2]]]);
//# sourceMappingURL=main.675d2392.chunk.js.map